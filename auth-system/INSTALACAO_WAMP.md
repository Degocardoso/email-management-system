# üöÄ Instala√ß√£o no WAMP - Guia R√°pido e Simplificado

## ‚ö° Solu√ß√£o R√°pida para o Erro

Se voc√™ viu o erro do Composer, execute:

```bash
cd C:\wamp64\www\email-management-system\auth-system
composer dump-autoload
```

---

## üìã PASSO A PASSO COMPLETO

### üóÑÔ∏è PASSO 1: Criar Banco de Dados

1. Acesse: **http://localhost/phpmyadmin**
2. Clique em **"SQL"** (aba no topo)
3. Cole e execute:

```sql
CREATE DATABASE auth_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

4. ‚úÖ Pronto! Banco criado.

---

### üìù PASSO 2: Configurar Credenciais

1. Abra o arquivo: `auth-system\.env`

2. **Se o arquivo n√£o existir**, renomeie `.env.example` para `.env`

3. Edite para ficar assim:

```env
APP_ENV=development
APP_DEBUG=true
SESSION_LIFETIME=7200
LOG_LEVEL=info

# MySQL - Configure aqui
DB_HOST=localhost
DB_DATABASE=auth_system
DB_USERNAME=root
DB_PASSWORD=
```

**‚ö†Ô∏è IMPORTANTE:** Se seu MySQL tem senha, coloque em `DB_PASSWORD=suasenha`

---

### üîß PASSO 3: Atualizar DatabaseService.php

Abra: `auth-system\src\Services\DatabaseService.php`

#### 3.1 - Encontre a linha 43 (m√©todo `connect()`):

**ANTES:**
```php
$this->connection = new PDO(
    'sqlite:' . $this->dbPath,
    null,
    null,
```

**DEPOIS:**
```php
// Carrega configura√ß√µes do .env
$host = $_ENV['DB_HOST'] ?? 'localhost';
$database = $_ENV['DB_DATABASE'] ?? 'auth_system';
$username = $_ENV['DB_USERNAME'] ?? 'root';
$password = $_ENV['DB_PASSWORD'] ?? '';

$this->connection = new PDO(
    "mysql:host={$host};dbname={$database};charset=utf8mb4",
    $username,
    $password,
```

#### 3.2 - Remova a linha 57 (ou pr√≥xima a ela):

**REMOVER ESTA LINHA:**
```php
// Habilita foreign keys no SQLite
$this->connection->exec('PRAGMA foreign_keys = ON');
```

#### 3.3 - Atualize o m√©todo `initializeTables()` (linha 73):

**Substitua TODO o conte√∫do de `$sql` por:**

```php
$sql = <<<SQL
CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role ENUM('admin', 'analyst', 'generator') NOT NULL,
    active TINYINT(1) DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_email (email),
    INDEX idx_role (role),
    INDEX idx_active (active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS user_sessions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    session_token VARCHAR(255) NOT NULL UNIQUE,
    ip_address VARCHAR(45),
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP NOT NULL,
    INDEX idx_token (session_token),
    INDEX idx_user (user_id),
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS audit_log (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    action VARCHAR(100) NOT NULL,
    description TEXT,
    ip_address VARCHAR(45),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_user (user_id),
    INDEX idx_created (created_at),
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
SQL;
```

**üíæ Salve o arquivo!**

---

### üì¶ PASSO 4: Instalar Depend√™ncias

Abra o **Prompt de Comando** (CMD) ou **PowerShell**:

```bash
cd C:\wamp64\www\email-management-system\auth-system

composer install

composer dump-autoload
```

---

### üë§ PASSO 5: Criar Usu√°rio Admin

No mesmo terminal:

```bash
php setup.php
```

Preencha:
```
Nome completo: Admin Sistema
Email: admin@teste.com
Senha: admin123
Confirmar senha: admin123
```

‚úÖ **Sucesso!** Voc√™ deve ver: "Setup conclu√≠do com sucesso!"

---

### üåê PASSO 6: Acessar o Sistema

Abra o navegador:

```
http://localhost/email-management-system/auth-system/public/
```

**Login:**
- Email: `admin@teste.com`
- Senha: `admin123`

---

## ‚úÖ Checklist R√°pido

- [ ] Banco `auth_system` criado no phpMyAdmin
- [ ] Arquivo `.env` criado e configurado
- [ ] `DatabaseService.php` atualizado (3 mudan√ßas)
- [ ] Executei `composer install`
- [ ] Executei `composer dump-autoload`
- [ ] Executei `php setup.php` com sucesso
- [ ] Consigo acessar http://localhost/email-management-system/auth-system/public/
- [ ] Consigo fazer login

---

## üî• Atalho: Arquivo DatabaseService.php Completo

Se preferir, aqui est√° o arquivo **COMPLETO** j√° corrigido para MySQL.

Substitua TODO o conte√∫do de `src\Services\DatabaseService.php` por este:

```php
<?php

namespace Auth\Services;

use PDO;
use PDOException;

/**
 * Servi√ßo de banco de dados MySQL
 * Gerencia conex√£o e opera√ß√µes do banco de dados
 */
class DatabaseService
{
    private static ?DatabaseService $instance = null;
    private ?PDO $connection = null;

    /**
     * Construtor privado para implementar Singleton
     */
    private function __construct()
    {
        $this->connect();
    }

    /**
     * Obt√©m inst√¢ncia √∫nica do DatabaseService
     */
    public static function getInstance(): DatabaseService
    {
        if (self::$instance === null) {
            self::$instance = new self();
        }
        return self::$instance;
    }

    /**
     * Conecta ao banco de dados MySQL
     */
    private function connect(): void
    {
        try {
            // Carrega configura√ß√µes do .env
            $host = $_ENV['DB_HOST'] ?? 'localhost';
            $database = $_ENV['DB_DATABASE'] ?? 'auth_system';
            $username = $_ENV['DB_USERNAME'] ?? 'root';
            $password = $_ENV['DB_PASSWORD'] ?? '';

            $this->connection = new PDO(
                "mysql:host={$host};dbname={$database};charset=utf8mb4",
                $username,
                $password,
                [
                    PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
                    PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
                    PDO::ATTR_EMULATE_PREPARES => false,
                ]
            );
        } catch (PDOException $e) {
            throw new \RuntimeException('Erro ao conectar ao banco de dados: ' . $e->getMessage());
        }
    }

    /**
     * Obt√©m a conex√£o PDO
     */
    public function getConnection(): PDO
    {
        if ($this->connection === null) {
            $this->connect();
        }
        return $this->connection;
    }

    /**
     * Inicializa as tabelas do banco de dados
     */
    public function initializeTables(): void
    {
        $sql = <<<SQL
        CREATE TABLE IF NOT EXISTS users (
            id INT AUTO_INCREMENT PRIMARY KEY,
            name VARCHAR(255) NOT NULL,
            email VARCHAR(255) NOT NULL UNIQUE,
            password VARCHAR(255) NOT NULL,
            role ENUM('admin', 'analyst', 'generator') NOT NULL,
            active TINYINT(1) DEFAULT 1,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
            INDEX idx_email (email),
            INDEX idx_role (role),
            INDEX idx_active (active)
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

        CREATE TABLE IF NOT EXISTS user_sessions (
            id INT AUTO_INCREMENT PRIMARY KEY,
            user_id INT NOT NULL,
            session_token VARCHAR(255) NOT NULL UNIQUE,
            ip_address VARCHAR(45),
            user_agent TEXT,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            expires_at TIMESTAMP NOT NULL,
            INDEX idx_token (session_token),
            INDEX idx_user (user_id),
            FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

        CREATE TABLE IF NOT EXISTS audit_log (
            id INT AUTO_INCREMENT PRIMARY KEY,
            user_id INT,
            action VARCHAR(100) NOT NULL,
            description TEXT,
            ip_address VARCHAR(45),
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            INDEX idx_user (user_id),
            INDEX idx_created (created_at),
            FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
        SQL;

        try {
            $this->connection->exec($sql);
        } catch (PDOException $e) {
            throw new \RuntimeException('Erro ao criar tabelas: ' . $e->getMessage());
        }
    }

    /**
     * Executa uma query e retorna os resultados
     */
    public function query(string $sql, array $params = []): array
    {
        try {
            $stmt = $this->connection->prepare($sql);
            $stmt->execute($params);
            return $stmt->fetchAll();
        } catch (PDOException $e) {
            throw new \RuntimeException('Erro ao executar query: ' . $e->getMessage());
        }
    }

    /**
     * Executa uma query e retorna uma √∫nica linha
     */
    public function queryOne(string $sql, array $params = []): ?array
    {
        try {
            $stmt = $this->connection->prepare($sql);
            $stmt->execute($params);
            $result = $stmt->fetch();
            return $result ?: null;
        } catch (PDOException $e) {
            throw new \RuntimeException('Erro ao executar query: ' . $e->getMessage());
        }
    }

    /**
     * Executa uma query de inser√ß√£o/atualiza√ß√£o/dele√ß√£o
     */
    public function execute(string $sql, array $params = []): bool
    {
        try {
            $stmt = $this->connection->prepare($sql);
            return $stmt->execute($params);
        } catch (PDOException $e) {
            throw new \RuntimeException('Erro ao executar comando: ' . $e->getMessage());
        }
    }

    /**
     * Retorna o ID do √∫ltimo insert
     */
    public function lastInsertId(): string
    {
        return $this->connection->lastInsertId();
    }

    /**
     * Inicia uma transa√ß√£o
     */
    public function beginTransaction(): bool
    {
        return $this->connection->beginTransaction();
    }

    /**
     * Confirma uma transa√ß√£o
     */
    public function commit(): bool
    {
        return $this->connection->commit();
    }

    /**
     * Reverte uma transa√ß√£o
     */
    public function rollback(): bool
    {
        return $this->connection->rollBack();
    }

    /**
     * Previne clonagem da inst√¢ncia
     */
    private function __clone() {}

    /**
     * Previne unserialization da inst√¢ncia
     */
    public function __wakeup()
    {
        throw new \Exception("Cannot unserialize singleton");
    }
}
```

---

## ‚ö†Ô∏è Erros Comuns e Solu√ß√µes

### ‚ùå Erro: "could not find driver"

**Solu√ß√£o:** Ativar PDO MySQL no WAMP

1. Clique no √≠cone do WAMP (bandeja do sistema)
2. PHP ‚Üí PHP Extensions
3. Marque: `php_pdo_mysql`
4. Restart All Services

### ‚ùå Erro: "Access denied for user 'root'@'localhost'"

**Solu√ß√£o:** Verificar senha do MySQL

Se voc√™ tem senha no MySQL, edite `.env`:
```env
DB_PASSWORD=suasenha
```

### ‚ùå Erro: "Unknown database 'auth_system'"

**Solu√ß√£o:** Banco n√£o foi criado

Acesse phpMyAdmin e execute:
```sql
CREATE DATABASE auth_system;
```

### ‚ùå Erro: 404 - Not Found

**Solu√ß√£o:** Habilitar mod_rewrite

1. WAMP ‚Üí Apache ‚Üí Apache Modules
2. Marque: `rewrite_module`
3. Restart All Services

---

## üéØ Comandos Resumidos

```bash
# Navegar
cd C:\wamp64\www\email-management-system\auth-system

# Instalar
composer install
composer dump-autoload

# Criar admin
php setup.php

# Acessar
# http://localhost/email-management-system/auth-system/public/
```

---

## üì∏ Como Deve Ficar

Ap√≥s login, voc√™ ver√°:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Dashboard                        Sair  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Bem-vindo, Admin Sistema!
Voc√™ est√° logado como Administrador

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Gerar     ‚îÇ ‚îÇ  Analisar   ‚îÇ ‚îÇ  Gerenciar  ‚îÇ
‚îÇ   Emails    ‚îÇ ‚îÇ   Emails    ‚îÇ ‚îÇ  Usu√°rios   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ‚úÖ Pronto!

Agora voc√™ tem:
- ‚úÖ Sistema de login funcionando
- ‚úÖ Dashboard com controle de acesso
- ‚úÖ Tela de gerenciamento de usu√°rios
- ‚úÖ 3 n√≠veis de permiss√£o (Admin, Analyst, Generator)

**Pr√≥ximo passo:** Integrar com os outros sistemas (gerador e analisador de emails)

Precisa de ajuda? Me mande o erro completo que aparecer! üöÄ
